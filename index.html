<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Berkah Printing - Dashboard & Marketplace</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-grad: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            --hero-grad: linear-gradient(135deg, #4b1169 0%, #ff1361 100%);
            --primary: #6a11cb;
            --accent: #ff1361;
            --dark: #1a1a2e;
            --light: #f4f7fe;
            --white: #ffffff;
            --sidebar-width: 260px;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; scroll-behavior: smooth; }
        body { background: var(--light); color: var(--dark); }
        
        .hidden { display: none !important; }
        .btn { padding: 10px 20px; border-radius: 8px; cursor: pointer; border: none; font-weight: 600; transition: 0.3s; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; }
        .btn-primary { background: var(--primary-grad); color: white; }
        .btn-outline { border: 1px solid var(--primary); color: var(--primary); background: transparent; }

        /* NAV */
        nav { background: var(--white); display: flex; justify-content: space-between; padding: 15px 8%; position: fixed; width: 100%; top: 0; z-index: 1000; box-shadow: 0 2px 15px rgba(0,0,0,0.05); }
        .logo { font-weight: 800; font-size: 20px; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        nav ul { display: flex; gap: 20px; align-items: center; list-style: none; }
        nav a { text-decoration: none; color: #555; font-size: 14px; font-weight: 500; }

        /* HERO */
        .hero { background: var(--hero-grad); height: 500px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; color: white; padding: 0 20px; clip-path: ellipse(150% 100% at 50% 0%); }
        .hero h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .search-container { background: white; padding: 5px; border-radius: 50px; display: flex; width: 100%; max-width: 600px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); margin-top: 20px; }
        .search-container input { border: none; flex: 1; padding: 10px 25px; outline: none; border-radius: 50px; }
        .search-container button { background: var(--primary); color: white; border: none; padding: 10px 25px; border-radius: 50px; cursor: pointer; }

        /* USER CONTENT - PRICELIST */
        .section { padding: 80px 8%; text-align: center; }
        .price-table-container { margin-top: 40px; background: white; padding: 20px; border-radius: 20px; box-shadow: var(--shadow); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th { background: #f8f9fa; padding: 15px; color: #666; font-size: 13px; text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid #eee; font-size: 14px; }

        /* ADMIN SIDEBAR */
        #admin-page { display: flex; min-height: 100vh; }
        .sidebar { width: var(--sidebar-width); background: white; padding: 25px; box-shadow: 5px 0 20px rgba(0,0,0,0.05); position: fixed; height: 100vh; z-index: 1100; }
        .sidebar-menu ul { list-style: none; margin-top: 20px; }
        .sidebar-menu li { padding: 12px 15px; border-radius: 10px; margin-bottom: 5px; cursor: pointer; color: #555; transition: 0.3s; font-size: 14px; display: flex; align-items: center; gap: 10px; }
        .sidebar-menu li:hover, .sidebar-menu li.active { background: var(--primary-grad); color: white; }
        .main-content { flex: 1; margin-left: var(--sidebar-width); padding: 40px; background: #f4f7fe; }

        /* MODAL */
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:2000; backdrop-filter: blur(5px); }
        .modal-content { background:white; padding:30px; border-radius:20px; width:90%; max-width:450px; }
        .modal-content input, .modal-content textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; }

        @media (max-width: 768px) {
            .sidebar { width: 70px; padding: 10px; }
            .sidebar span, .sidebar h4 { display: none; }
            .main-content { margin-left: 70px; padding: 20px; }
            nav ul { display: none; }
        }
    </style>
</head>
<body>

    <div id="user-view">
        <nav>
            <div class="logo"><i class="fas fa-print"></i> <span>Berkah Printing</span></div>
            <ul>
                <li><a href="#">Beranda</a></li>
                <li><a href="#produk">Cek Harga</a></li>
                <li><a href="#lokasi">Lokasi</a></li>
                <li><button class="btn btn-primary" onclick="showPage('login-page')">Login Admin</button></li>
            </ul>
        </nav>

        <section class="hero">
            <h1>Layanan Cetak Digital</h1>
            <p>Harga terupdate langsung dari sistem produksi kami</p>
            <div class="search-container">
                <input type="text" id="user-search" placeholder="Cari layanan (contoh: Stempel, Print)..." onkeyup="filterUserTable()">
                <button><i class="fas fa-search"></i></button>
            </div>
        </section>

        <section class="section" id="produk">
            <h2>Daftar Harga Layanan</h2>
            <p>Data otomatis sinkron dengan database pusat</p>
            
            <div class="price-table-container">
                <table id="user-price-table">
                    <thead>
                        <tr>
                            <th>Kategori</th>
                            <th>Nama Layanan</th>
                            <th>Harga</th>
                            <th>Keterangan</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="user-table-body">
                        </tbody>
                </table>
            </div>
        </section>

        <section class="section" id="lokasi" style="background: white;">
            <h2>Lokasi & Operasional</h2>
            <div style="display: flex; flex-wrap: wrap; gap: 30px; margin-top: 30px;">
                <div style="flex: 1; min-width: 300px; text-align: left; background: #f8f9fa; padding: 30px; border-radius: 20px;">
                    <h3><i class="fas fa-store"></i> Toko Utama</h3><br>
                    <p><b>Alamat:</b> Kopang Rembiga, Kec. Kopang, Kabupaten Lombok Tengah, Nusa Tenggara Barat, Indonesia</p><br>
                    <p><i class="fas fa-clock"></i> <b>Senin - Sabtu:</b> 08.00 - 21.00 WITA</p>
                    <p><i class="fas fa-calendar-times"></i> <b>Minggu:</b> Tutup</p><br>
                    <a href="https://wa.me/6287860180561" class="btn btn-primary"><i class="fab fa-whatsapp"></i> Chat Admin</a>
                </div>
                <div style="flex: 2; min-width: 300px; height: 350px;">
                    <iframe width="100%" height="100%" style="border-radius: 20px; border:0;" 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d15771.551229555135!2d116.34533085!3d-8.63554165!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2dcdb163e030a579%3A0x5030bf4b3ec6650!2sKopang%20Rembiga%2C%20Kec.%20Kopang%2C%20Kabupaten%20Lombok%20Tengah%2C%20Nusa%20Tenggara%20Bar.!5e0!3m2!1sid!2sid!4v1700000000000!5m2!1sid!2sid" 
                        allowfullscreen="" loading="lazy"></iframe>
                </div>
            </div>
        </section>
    </div>

    <div id="login-page" class="hidden" style="height: 100vh; background: var(--primary-grad); display: flex; align-items: center; justify-content: center;">
        <div class="modal-content" style="text-align: center;">
            <h2>Admin Login</h2><br>
            <input type="text" id="l-user" placeholder="Username">
            <input type="password" id="l-pass" placeholder="Password">
            <button class="btn btn-primary" style="width:100%" onclick="doLogin()">Masuk Dashboard</button>
            <p style="margin-top: 15px; cursor: pointer; color: #888;" onclick="showPage('user-view')">Kembali</p>
        </div>
    </div>

    <div id="admin-page" class="hidden">
        <aside class="sidebar">
            <div class="logo"><i class="fas fa-user-shield"></i> <span>Admin Berkah</span></div>
            <div class="sidebar-menu">
                <ul>
                    <li id="m-stats" class="active" onclick="switchTab('stats')"><i class="fas fa-chart-line"></i> <span>Statistik</span></li>
                </ul>
                <h4 style="font-size: 11px; margin: 20px 0 10px 15px; color: #aaa;">MANAJEMEN LAYANAN</h4>
                <ul id="sidebar-cats">
                    </ul>
                <button class="btn btn-outline" style="margin-top: 20px; width: 100%; border-color: #ff4757; color: #ff4757;" onclick="showPage('user-view')">
                    <i class="fas fa-sign-out-alt"></i> <span>Keluar</span>
                </button>
            </div>
        </aside>

        <main class="main-content">
            <div id="tab-stats">
                <h2>Ringkasan Bisnis</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 25px 0;">
                    <div style="background: white; padding: 20px; border-radius: 15px; border-left: 5px solid green;">
                        <small>Total Lunas (Pendapatan)</small>
                        <h2 id="stat-rev">Rp 0</h2>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 15px; border-left: 5px solid orange;">
                        <small>Total Piutang (Hutang)</small>
                        <h2 id="stat-debt">Rp 0</h2>
                    </div>
                </div>
                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: var(--shadow);">
                    <canvas id="salesChart" height="100"></canvas>
                </div>
            </div>

            <div id="tab-manage" class="hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 id="current-cat-title">Manajemen Data</h2>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="admin-search" placeholder="Cari di tabel..." onkeyup="filterAdminTable()" style="padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
                        <button class="btn btn-primary" onclick="openModal()">+ Tambah Item</button>
                    </div>
                </div>
                <div style="background: white; border-radius: 15px; padding: 20px; overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Layanan</th>
                                <th>Harga</th>
                                <th>Keterangan</th>
                                <th>Opsi Transaksi</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="admin-table-body"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <div id="modal-form" class="modal hidden">
        <div class="modal-content">
            <h3 id="modal-title">Edit Layanan</h3>
            <input type="hidden" id="edit-id">
            <input type="text" id="f-nama" placeholder="Nama Layanan (Contoh: Print Warna)">
            <input type="number" id="f-harga" placeholder="Harga (Rp)">
            <textarea id="f-desc" placeholder="Keterangan singkat..."></textarea>
            <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                <button class="btn" onclick="closeModal()">Batal</button>
                <button class="btn btn-primary" onclick="saveData()">Simpan Perubahan</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURATION
        const categories = ["Photocopy", "Print", "Cetak Foto", "Banner", "Stempel", "Undangan", "ATK", "Lain-lain"];
        let db = JSON.parse(localStorage.getItem('berkah_print_db')) || {};
        let transactions = JSON.parse(localStorage.getItem('berkah_trx_v2')) || [];
        let currentCat = "Photocopy";
        let salesChart;

        // Initialize Database Categories
        categories.forEach(c => { if(!db[c]) db[c] = []; });

        // --- CORE FUNCTIONS ---
        function showPage(id) {
            document.querySelectorAll('#user-view, #login-page, #admin-page').forEach(p => p.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            if(id === 'admin-page') { renderSidebar(); switchTab('stats'); }
            if(id === 'user-view') { renderUserPriceList(); }
        }

        function switchTab(tab) {
            document.querySelectorAll('#tab-stats, #tab-manage').forEach(t => t.classList.add('hidden'));
            document.querySelectorAll('.sidebar-menu li').forEach(l => l.classList.remove('active'));

            if(tab === 'stats') {
                document.getElementById('tab-stats').classList.remove('hidden');
                document.getElementById('m-stats').classList.add('active');
                updateStats();
                initChart();
            } else {
                currentCat = tab;
                document.getElementById('tab-manage').classList.remove('hidden');
                document.getElementById('current-cat-title').innerText = "Kelola: " + tab;
                document.getElementById('m-' + tab.replace(/\s/g, '')).classList.add('active');
                renderAdminTable();
            }
        }

        // --- USER VIEW FUNCTIONS ---
        function renderUserPriceList() {
            const tbody = document.getElementById('user-table-body');
            tbody.innerHTML = '';
            
            categories.forEach(cat => {
                db[cat].forEach(item => {
                    tbody.innerHTML += `
                        <tr>
                            <td><span style="background:#eee; padding:3px 8px; border-radius:5px; font-size:11px;">${cat}</span></td>
                            <td><b>${item.nama}</b></td>
                            <td style="color:var(--primary); font-weight:700;">Rp ${Number(item.harga).toLocaleString()}</td>
                            <td style="color:#777; font-size:12px;">${item.desc}</td>
                            <td><a href="https://wa.me/6287860180561?text=Halo, saya ingin pesan ${item.nama}" class="btn-primary" style="padding:5px 10px; border-radius:5px; font-size:12px;">Pesan</a></td>
                        </tr>
                    `;
                });
            });
        }

        function filterUserTable() {
            let input = document.getElementById("user-search").value.toUpperCase();
            let tr = document.getElementById("user-table-body").getElementsByTagName("tr");
            for (let i = 0; i < tr.length; i++) {
                let txtValue = tr[i].textContent || tr[i].innerText;
                tr[i].style.display = txtValue.toUpperCase().indexOf(input) > -1 ? "" : "none";
            }
        }

        // --- ADMIN FUNCTIONS ---
        function renderSidebar() {
            const sideUl = document.getElementById('sidebar-cats');
            sideUl.innerHTML = '';
            categories.forEach(c => {
                sideUl.innerHTML += `<li id="m-${c.replace(/\s/g, '')}" onclick="switchTab('${c}')"><i class="fas fa-folder"></i> <span>${c}</span></li>`;
            });
        }

        function renderAdminTable() {
            const tbody = document.getElementById('admin-table-body');
            tbody.innerHTML = '';
            db[currentCat].forEach((item) => {
                tbody.innerHTML += `
                    <tr>
                        <td><b>${item.nama}</b></td>
                        <td>Rp ${Number(item.harga).toLocaleString()}</td>
                        <td style="font-size:12px;">${item.desc}</td>
                        <td>
                            <button class="btn" style="background:#2ecc71; color:white; padding:5px 10px;" onclick="addTrx(${item.harga}, 'lunas')">Lunas</button>
                            <button class="btn" style="background:#f39c12; color:white; padding:5px 10px;" onclick="addTrx(${item.harga}, 'piutang')">Piutang</button>
                        </td>
                        <td>
                            <button class="btn" style="color:blue;" onclick="openModal(${item.id})"><i class="fas fa-edit"></i></button>
                            <button class="btn" style="color:red;" onclick="deleteData(${item.id})"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
        }

        function saveData() {
            const id = document.getElementById('edit-id').value;
            const nama = document.getElementById('f-nama').value;
            const harga = document.getElementById('f-harga').value;
            const desc = document.getElementById('f-desc').value;

            if(!nama || !harga) return alert("Nama dan Harga wajib diisi!");

            if(!id) {
                db[currentCat].push({ id: Date.now(), nama, harga, desc });
            } else {
                const idx = db[currentCat].findIndex(x => x.id == id);
                db[currentCat][idx] = { id: parseInt(id), nama, harga, desc };
            }
            
            localStorage.setItem('berkah_print_db', JSON.stringify(db));
            closeModal();
            renderAdminTable();
            renderUserPriceList(); // Sinkron Otomatis
        }

        function deleteData(id) {
            if(confirm("Hapus item ini?")) {
                db[currentCat] = db[currentCat].filter(x => x.id != id);
                localStorage.setItem('berkah_print_db', JSON.stringify(db));
                renderAdminTable();
                renderUserPriceList();
            }
        }

        function addTrx(amt, status) {
            transactions.push({ amount: parseInt(amt), status: status, date: new Date().toLocaleDateString() });
            localStorage.setItem('berkah_trx_v2', JSON.stringify(transactions));
            alert(status === 'lunas' ? "Transaksi disimpan!" : "Piutang dicatat!");
            updateStats();
        }

        function updateStats() {
            const rev = transactions.filter(t => t.status === 'lunas').reduce((a,b) => a + b.amount, 0);
            const debt = transactions.filter(t => t.status === 'piutang').reduce((a,b) => a + b.amount, 0);
            document.getElementById('stat-rev').innerText = "Rp " + rev.toLocaleString();
            document.getElementById('stat-debt').innerText = "Rp " + debt.toLocaleString();
        }

        function initChart() {
            const ctx = document.getElementById('salesChart').getContext('2d');
            if(salesChart) salesChart.destroy();
            
            // Mengambil data unik 5 hari terakhir
            const labels = [...new Set(transactions.map(t => t.date))].slice(-5);
            const dataPoint = labels.map(l => {
                return transactions.filter(t => t.date === l && t.status === 'lunas').reduce((a,b) => a + b.amount, 0);
            });

            salesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels.length ? labels : ['Hari Ini'],
                    datasets: [{
                        label: 'Pendapatan Harian',
                        data: dataPoint.length ? dataPoint : [0],
                        borderColor: '#6a11cb',
                        backgroundColor: 'rgba(106, 17, 203, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                }
            });
        }

        function doLogin() {
            if(document.getElementById('l-user').value === 'admin' && document.getElementById('l-pass').value === 'admin123') {
                showPage('admin-page');
            } else {
                alert("Salah password! (User: admin, Pass: admin123)");
            }
        }

        function openModal(id = null) {
            document.getElementById('modal-form').classList.remove('hidden');
            if(id) {
                const item = db[currentCat].find(x => x.id == id);
                document.getElementById('edit-id').value = id;
                document.getElementById('f-nama').value = item.nama;
                document.getElementById('f-harga').value = item.harga;
                document.getElementById('f-desc').value = item.desc;
                document.getElementById('modal-title').innerText = "Edit Data";
            } else {
                document.getElementById('edit-id').value = '';
                document.getElementById('f-nama').value = '';
                document.getElementById('f-harga').value = '';
                document.getElementById('f-desc').value = '';
                document.getElementById('modal-title').innerText = "Tambah Data Baru";
            }
        }

        function closeModal() { document.getElementById('modal-form').classList.add('hidden'); }
        
        function filterAdminTable() {
            let input = document.getElementById("admin-search").value.toUpperCase();
            let tr = document.getElementById("admin-table-body").getElementsByTagName("tr");
            for (let i = 0; i < tr.length; i++) {
                let txtValue = tr[i].textContent || tr[i].innerText;
                tr[i].style.display = txtValue.toUpperCase().indexOf(input) > -1 ? "" : "none";
            }
        }

        // LOAD FIRST TIME
        renderUserPriceList();
    </script>
</body>
</html>
